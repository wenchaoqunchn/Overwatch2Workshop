设置
{
	模式
	{
		禁用 占领要点
		{
			职责限制: 1重装，2输出，2支援
		}

		禁用 攻击护送
		{
			职责限制: 1重装，2输出，2支援
		}

		禁用 机动推进
		{
			职责限制: 1重装，2输出，2支援
		}

		训练靶场
		{
			英雄限制: 关闭
		}

		禁用 运载目标
		{
			职责限制: 1重装，2输出，2支援
		}

		禁用 闪点作战
		{
			职责限制: 1重装，2输出，2支援
		}
	}

	英雄
	{
		综合
		{
			技能冷却时间: 100%

			黑影
			{
				位移传动冷却时间: 50%
				病毒侵染冷却时间: 50%
			}

			启用英雄
			{
				黑影
			}
		}
	}
}

变量
{
	全局:
		0: textIDs

	玩家:
		0: invis
		1: detected
        2: dmgID
        3: hlID
}

规则("初始化黑影隐身能量条")
{
	事件
	{
		持续 - 每名玩家;
		队伍1;
		黑影;
	}

	条件
	{
		存活(事件玩家) == 真;
		已重生(事件玩家) == 真;
	}

	动作
	{
		事件玩家.invis = 100;
	}
}

规则("黑影隐身能量条消耗")
{
	事件
	{
		持续 - 每名玩家;
		队伍1;
		黑影;
	}

	条件
	{
		存活(事件玩家) == 真;
        事件玩家.detected == 假;
	}

	动作
	{
		If(事件玩家.invis < 1);
			开始持续伤害(事件玩家, 空, 9999, 1);
            事件玩家.dmgID = 上一个持续伤害效果ID;
			开始持续治疗(事件玩家, 空, 9999, 1);
            事件玩家.hlID = 上一个持续治疗效果ID;
            小字体信息(事件玩家, 自定义字符串("开始dot"));
            等待(2,无视条件);
            小字体信息(事件玩家, 自定义字符串("detected=真"));
            事件玩家.detected = 真;
		Else;
			事件玩家.invis -= 0.1;
		End;
		等待(0.001, 无视条件);
		如条件为“真”则循环;
	}
}

规则("黑影隐身能量条恢复")
{
	事件
	{
		持续 - 每名玩家;
		队伍1;
		黑影;
	}

	条件
	{
		事件玩家.invis < 100;
		事件玩家.detected == 真;
		存活(事件玩家) == 真;
		已重生(事件玩家) == 真;
	}

	动作
	{
		"at this rate, it takes 10 seconds to fully refill her 100 stealth resource"
		事件玩家.invis += 0.1;
		等待(0.01, 无视条件);
		如条件为“真”则循环;
	}
}

规则("create progress bar for sombra's stealth resource meter")
{
	事件
	{
		持续 - 全局;
	}

	条件
	{
		正在使用英雄(英雄(黑影), 队伍1) == 真;
	}

	动作
	{
		创建HUD文本(本地玩家.invis <= 100 && 所用英雄(本地玩家) == 英雄(黑影) ? 本地玩家 : 空, 空, 空, 自定义字符串(" \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"), 顶部, 5, 空,
			空, 空, 可见, 默认可见度);
		全局.textIDs[0] = 上一个文本ID;
		创建进度条HUD文本(本地玩家.invis <= 100 && 所用英雄(本地玩家) == 英雄(黑影) ? 本地玩家 : 空, 本地玩家.invis, 自定义字符串("{0} 隐身", 技能图标字符串(英雄(黑影), 按钮(终极技能))), 顶部, 6,
			自定义颜色(118, 93, 189, 255), 颜色(白色), 可见，值和颜色, 默认可见度);
		在索引处修改全局变量(textIDs, 0, 添加至数组, 上一个文本ID);
		等待直到 (!正在使用英雄(英雄(黑影), 队伍1), 9999);
		消除HUD文本(首个(首个(全局.textIDs)));
		消除进度条HUD文本(首个(全局.textIDs)[1]);
	}
}

规则("进入隐身")
{
	事件
	{
		持续 - 每名玩家;
		队伍1;
		黑影;
	}

    条件
	{
        
		事件玩家.detected == 真;
        按钮被按下(事件玩家, 按钮(互动)) == 真;
	}

	动作
	{
		If(事件玩家.invis > 1);
            事件玩家.detected = 假;
	        停止持续伤害(事件玩家.dmgID);
            停止持续治疗(事件玩家.hlID);
            小字体信息(事件玩家, 自定义字符串("进入隐身"));
        Else;
            小字体信息(事件玩家, 自定义字符串("无法隐身"));
        End;
        等待(2, 无视条件);
	}
}

规则("取消隐身")
{
	事件
	{
		持续 - 每名玩家;
		队伍1;
		黑影;
	}

    条件
	{
		事件玩家.detected == 假;
        (按钮被按下(事件玩家, 按钮(互动)) || 按钮被按下(事件玩家, 按钮(技能1)) || 按钮被按下(事件玩家, 按钮(主要攻击模式))) == 真;
	}

	动作
	{
		事件玩家.detected = 真;
        小字体信息(事件玩家, 自定义字符串("取消隐身"));
        等待(2, 无视条件);
	}

}